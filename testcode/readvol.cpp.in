#include <Inventor/@Gui@/So@Gui@.h>
#include <Inventor/@Gui@/viewers/So@Gui@ExaminerViewer.h>
#include <Inventor/nodes/SoCube.h>
#include <Inventor/nodes/SoDirectionalLight.h>
#include <Inventor/nodes/SoDrawStyle.h>
#include <Inventor/nodes/SoLightModel.h>
#include <Inventor/nodes/SoPerspectiveCamera.h>
#include <Inventor/nodes/SoSeparator.h>
#include <VolumeViz/nodes/SoTransferFunction.h>
#include <VolumeViz/nodes/SoVolumeData.h>
#include <VolumeViz/nodes/SoVolumeRender.h>
#include <VolumeViz/nodes/SoVolumeRendering.h>
#include <VolumeViz/readers/SoVRVolFileReader.h>


int
main(int argc, char ** argv)
{
  if (argc != 2) {
    fprintf(stderr, "\nUsage: %s dataset.vol\n\n", argv[0]);
    exit(1);
  }

  @WIDGET@ window = So@Gui@::init(argv[0]);
  SoVolumeRendering::init();

  SoSeparator *root = new SoSeparator;
  root->ref();

  SoVRVolFileReader * filereader = new SoVRVolFileReader;
  filereader->setUserData(argv[1]);

  SbBox3f size;
  SoVolumeData::DataType type;
  SbVec3s dim;
  filereader->getDataChar(size, type, dim);
  
  // Add VolumeData to scene graph
  SoVolumeData * pVolData = new SoVolumeData();
  pVolData->setReader(filereader);
  pVolData->setVolumeSize(SbBox3f(-1, -1, -1, 1, 1, 1));

  root->addChild(pVolData);

  // Add TransferFunction (color map) to scene graph
  SoTransferFunction *pTransFunc = new SoTransferFunction();
  root->addChild(pTransFunc);

  // Add VolumeRender to scene graph
  SoVolumeRender * pVolRend = new SoVolumeRender();
  root->addChild(pVolRend);
  pVolRend->numSlices = 64;

  SoLightModel * lm = new SoLightModel;
  lm->model = SoLightModel::BASE_COLOR;
  root->addChild(lm);

  SoDrawStyle *drawStyle = new SoDrawStyle;
  drawStyle->style = SoDrawStyle::LINES;
  root->addChild(drawStyle);
  root->addChild(new SoCube);

  So@Gui@ExaminerViewer * ex = new So@Gui@ExaminerViewer(window);
  ex->setSceneGraph(root);

  ex->show();
  So@Gui@::show(window);
  So@Gui@::mainLoop();

  delete ex;
  delete filereader;
  root->unref();

  return 0;
}
